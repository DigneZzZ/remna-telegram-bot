# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Aiogram

## –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**: –ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å python-telegram-bot –Ω–∞ Aiogram  
‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**: –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤  
üîÑ **–í –ü–†–û–¶–ï–°–°–ï**: –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚è≥ **–û–ñ–ò–î–ê–ï–¢**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º API  

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ùå –£–¥–∞–ª–µ–Ω–æ: `python-telegram-bot==20.6` (–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å httpx)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: `aiogram==3.20.0` (—Å–æ–≤–º–µ—Å—Ç–∏–º —Å remnawave_api)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: `remnawave_api` (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK)

### –§–∞–π–ª—ã

#### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã Aiogram
- `main_aiogram.py` - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
- `modules/handlers_aiogram/` - –ü–∞–ø–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ Aiogram
  - `auth.py` - –§–∏–ª—å—Ç—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - `start_handler.py` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
  - `menu_handler.py` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
  - `user_handlers.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - `node_handlers.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (–∑–∞–≥–ª—É—à–∫–∞)
  - `stats_handlers.py` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∑–∞–≥–ª—É—à–∫–∞)
  - `host_handlers.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞–º–∏ (–∑–∞–≥–ª—É—à–∫–∞)
  - `inbound_handlers.py` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Inbounds (–∑–∞–≥–ª—É—à–∫–∞)
  - `bulk_handlers.py` - –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∑–∞–≥–ª—É—à–∫–∞)

#### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `test_aiogram_basic.py` - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç Aiogram
- `docker-compose-aiogram.yml` - Docker –¥–ª—è Aiogram –≤–µ—Ä—Å–∏–∏

## –ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

### python-telegram-bot vs Aiogram

| –ê—Å–ø–µ–∫—Ç | python-telegram-bot | Aiogram |
|--------|-------------------|---------|
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | Application + Handlers | Bot + Dispatcher + Router |
| –°–æ—Å—Ç–æ—è–Ω–∏—è | ConversationHandler | FSM (Finite State Machine) |
| –§–∏–ª—å—Ç—Ä—ã | filters.* | Filter –∫–ª–∞—Å—Å—ã |
| Callback Query | CallbackQueryHandler | @router.callback_query |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | httpx (–∫–æ–Ω—Ñ–ª–∏–∫—Ç) | aiohttp (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ) |

### –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞

**–°—Ç–∞—Ä—ã–π –∫–æ–¥ (python-telegram-bot):**
```python
from telegram.ext import Application, CommandHandler
from telegram import Update
from telegram.ext import ContextTypes

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ü—Ä–∏–≤–µ—Ç!")

app = Application.builder().token(token).build()
app.add_handler(CommandHandler("start", start))
app.run_polling()
```

**–ù–æ–≤—ã–π –∫–æ–¥ (Aiogram):**
```python
from aiogram import Bot, Dispatcher, Router, types
from aiogram.filters import CommandStart

router = Router()

@router.message(CommandStart())
async def start_handler(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")

dp = Dispatcher()
dp.include_router(router)
await dp.start_polling(bot)
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –±–∞–∑–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
python3 test_aiogram_basic.py

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env)
python3 main_aiogram.py
```

### Docker —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –°–±–æ—Ä–∫–∞ —Å Aiogram
docker-compose -f docker-compose-aiogram.yml build

# –ó–∞–ø—É—Å–∫ —Å Aiogram
docker-compose -f docker-compose-aiogram.yml up
```

## –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ó–∞–≥–ª—É—à–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–º–µ—é—Ç –±–∞–∑–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
2. **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º Remnawave API
3. **FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –±–∞–∑–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
2. üîÑ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
4. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FSM –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
5. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º API
6. ‚è≥ –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ old main.py

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

- ‚úÖ –†–µ—à–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π httpx
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å remnawave_api SDK
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Router –∏ FSM
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞—Ç–∏–≤–Ω—ã–π async)
- ‚úÖ –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
